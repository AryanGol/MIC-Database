<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MIC Database</title>

  <!-- DataTables core + extensions -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.colVis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>

  <!-- SheetJS for reading XLSX (keeps hyperlinks) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#0b1220;
      --card: rgba(255,255,255,0.92);
      --stroke: rgba(255,255,255,0.20);
      --text:#0b1220;
      --shadow: 0 18px 45px rgba(0,0,0,0.25);
      --r: 18px;
      --p: #7c3aed;
      --c: #06b6d4;
      --g: #22c55e;
      --o: #f59e0b;
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1100px 600px at 10% 10%, rgba(124,58,237,0.35), transparent 55%),
        radial-gradient(900px 500px at 90% 15%, rgba(6,182,212,0.28), transparent 55%),
        radial-gradient(900px 500px at 50% 95%, rgba(34,197,94,0.20), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      color: white;
      overflow-x: auto;
    }

    .wrap{ width: 100%; max-width: none; margin: 0; padding: 26px 16px 46px; box-sizing: border-box; }

    .hero{
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      background: linear-gradient(135deg, rgba(255,255,255,0.13), rgba(255,255,255,0.06));
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
    }
    .topline{ display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap; }
    .brand{ display:flex; align-items:center; gap:12px; }
    .logo{
      width: 42px; height: 42px; border-radius: 14px;
      background: linear-gradient(135deg, var(--p), var(--c));
      box-shadow: 0 10px 28px rgba(124,58,237,0.25);
    }
    h1{ margin:0; font-size: 18px; letter-spacing: .2px; }
    .sub{ margin:6px 0 0; color: rgba(255,255,255,0.78); font-size: 13px; line-height: 1.35; }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.10);
      font-size: 12px;
      white-space: nowrap;
    }
    .dot{
      width: 8px; height: 8px; border-radius: 999px;
      background: var(--g);
      box-shadow: 0 0 0 4px rgba(34,197,94,0.18);
    }

    .controls{
      margin-top: 14px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      padding: 14px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 980px){
      .controls{ grid-template-columns: 1fr 1fr 1fr 1fr 1fr; align-items:end; }
      .controls .wide{ grid-column: span 5; }
    }
    label{
      display:block; font-size: 12px;
      color: rgba(255,255,255,0.86);
      margin-bottom: 6px;
    }
    .field input, .field button{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.10);
      color: white;
      outline: none;
      font-size: 13px;
      box-sizing: border-box;
    }
    .field input::placeholder{ color: rgba(255,255,255,0.70); }
    .field button{
      cursor:pointer;
      border: none;
      font-weight: 800;
      letter-spacing: .2px;
      background: linear-gradient(135deg, var(--o), var(--p));
      box-shadow: 0 12px 30px rgba(245,158,11,0.18);
    }

    .card{
      margin-top: 14px;
      border-radius: var(--r);
      background: var(--card);
      color: var(--text);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.16);
      overflow: hidden;
    }
    .pad{ padding: 12px 12px 6px; }

    table.dataTable{ width:100% !important; }
    table.dataTable thead th{
      white-space: nowrap;
      background: linear-gradient(135deg, rgba(124,58,237,0.14), rgba(6,182,212,0.10));
      border-bottom: 1px solid rgba(0,0,0,0.08) !important;
      color: #0b1220;
    }

    #tbl thead tr.filters th{
      background: rgba(255,255,255,0.98);
      padding: 8px 10px !important;
      border-bottom: 1px solid rgba(0,0,0,0.08) !important;
      vertical-align: top;
    }
    .colFilter{
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 140px;
    }
    .colFilter input,
    .colFilter select{
      width: 100%;
      box-sizing: border-box;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.14);
      font-size: 12px;
      outline: none;
      background: #fff;
      color: #0b1220;
    }

    .dataTables_wrapper .dataTables_filter input{
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.15);
      padding: 7px 10px;
      outline: none;
    }
    .dt-buttons .dt-button{
      border-radius: 999px !important;
      border: 1px solid rgba(0,0,0,0.12) !important;
      background: linear-gradient(135deg, rgba(124,58,237,0.10), rgba(6,182,212,0.10)) !important;
      padding: 7px 12px !important;
      font-size: 12px !important;
      color: #0b1220 !important;
    }

    a{ color: #4f46e5; text-decoration: none; font-weight: 650; }
    a:hover{ text-decoration: underline; }

    table.dataTable tbody tr:hover{
      background: rgba(6,182,212,0.08) !important;
      cursor: pointer;
    }

    td.details-control{
      cursor: pointer;
      white-space: nowrap;
      font-weight: 900;
      color: #4f46e5;
    }
    tr.shown td.details-control{
      color: #0ea5e9;
    }
    .detailsBox{
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(79,70,229,0.06);
      border: 1px solid rgba(0,0,0,0.08);
      line-height: 1.4;
      font-size: 13px;
      color: #0b1220;
    }
    .detailsBox .k{
      font-weight: 800;
      margin-right: 6px;
    }

    .tableWrap{
      width: 100%;
      overflow-x: auto;
      overflow-y: visible;
      -webkit-overflow-scrolling: touch;
    }
    .dataTables_scrollBody{
      overflow-x: auto !important;
    }
    .dataTables_wrapper { width: 100%; }
  </style>
</head>

<body>
<div class="wrap">

  <div class="hero">
    <div class="topline">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>MIC Database</h1>
          <div class="sub">Merged dataset (XLSX)</div>
        </div>
      </div>
      <div class="badge"><span class="dot"></span><span id="rowCount">0 rows</span></div>
    </div>

    <div class="controls">
      <div class="field">
        <label>Search article by Title (global)</label>
        <input id="titleGlobal" type="text" placeholder="Type part of the title…">
      </div>

      <div class="field">
        <label>Search by PMCID (global)</label>
        <input id="pmcGlobal" type="text" placeholder="PMC10174691">
      </div>

      <div class="field">
        <label>Search by Parameter (global)</label>
        <input id="paramGlobal" type="text" placeholder="MIC, EC50, growth rate...">
      </div>

      <div class="field">
        <label>Search by Drug/compound (global)</label>
        <input id="drugGlobal" type="text" placeholder="Vancomycin...">
      </div>

      <div class="field">
        <label>Search by Species (global)</label>
        <input id="speciesGlobal" type="text" placeholder="Pseudomonas aeruginosa...">
      </div>

      <div class="field wide">
        <button id="clearAll">Clear all filters</button>
        <div style="margin-top:10px;font-size:12px;color:rgba(255,255,255,0.75)">
          Data source: <code>merged_results (1).xlsx</code>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="pad">
      <div class="tableWrap">
        <table id="tbl" class="display nowrap" style="width:100%">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script>
(function () {
  // ✅ Your repo file name (space + parentheses is OK because we encode it when fetching)
  const XLSX_FILE = "merged_results (1).xlsx";

  // Canonical field labels (what our code uses internally)
  const H = {
    pmc: "PMCID",
    parameter: "Parameter",
    value: "Reported numerical value",
    unit: "Unit",

    testedIsolate: "Tested Isolate",
    species: "Bacterial species name(s) in that isolate",
    strain: "Bacterial strain(s) in that isolate",
    source: "Source of biological entities in that isolate",
    status: "Wild-type or mutant status / genotype name in that isolate",
    mode: "Biofilm / planktonic / mixed in that isolate",
    drug: "Drug or chemical compound name(s)",

    title: "Title",
    citation: "Citation",
    evidence: "Evidence"
  };

  const VISIBLE_HEADERS = [
    H.pmc,
    H.species,
    H.drug,
    H.parameter,
    H.value, H.unit,
    H.strain, H.source, H.status, H.mode
  ];

  const DROPDOWN_COLS = new Set([
    H.parameter, H.unit, H.species, H.strain, H.source, H.status, H.mode, H.drug
  ]);

  function cleanVal(x){
    const v = (x ?? "").toString().replace(/\u00A0/g, " ").trim();
    if (!v) return "";
    if (/^(nan|null|none)$/i.test(v)) return "";
    return v;
  }
  function escapeHtml(s){ return $("<div>").text(s ?? "").html(); }
  function sanitizeHttpUrl(u){
    u = cleanVal(u);
    if (!/^https?:\/\/\S+/i.test(u)) return "";
    return u;
  }
  function renderLink(url, label){
    const href = sanitizeHttpUrl(url);
    if (!href) return escapeHtml(label ?? "");
    const safeLabel = escapeHtml((label ?? href).toString());
    return `<a href="${escapeHtml(href)}" target="_blank" rel="noopener noreferrer">${safeLabel}</a>`;
  }

  function pmcUrlFromId(pmcid) {
    const v = cleanVal(pmcid);
    const m = v.match(/^PMC?(\d+)$/i);
    if (!m) return "";
    return `https://pmc.ncbi.nlm.nih.gov/articles/PMC${m[1]}/`;
  }
  function pmcLink(pmcid) {
    const v = cleanVal(pmcid);
    if (!v) return "";
    const m = v.match(/^PMC?(\d+)$/i);
    if (m) {
      const id = m[1];
      const url = `https://pmc.ncbi.nlm.nih.gov/articles/PMC${id}/`;
      return `<a href="${url}" target="_blank" rel="noopener noreferrer">PMC${id}</a>`;
    }
    return escapeHtml(v);
  }

  function uniqueSorted(arr) {
    return Array.from(new Set(arr.map(x => cleanVal(x)).filter(Boolean)))
      .sort((a,b)=>a.localeCompare(b, undefined, {numeric:true, sensitivity:"base"}));
  }

  // Map sheet headers -> canonical keys
  function canonicalHeader(h){
    const s = cleanVal(h).toLowerCase();

    if (/^(pmcid|pmc\s*id)$/i.test(s)) return H.pmc;
    if (/^parameter\b/.test(s)) return H.parameter;
    if (/reported\s+numerical\s+value/.test(s) || /^reported\s*value$/.test(s) || /^value$/.test(s)) return H.value;
    if (/^unit$/.test(s)) return H.unit;

    if (/^evidence$/.test(s)) return H.evidence;
    if (/^tested\s*isolate$/.test(s)) return H.testedIsolate;

    if (/^bacterial\s+species/.test(s) || /^species$/.test(s) || /organism/.test(s)) return H.species;
    if (/^bacterial\s+strain/.test(s) || /^strain$/.test(s)) return H.strain;
    if (/^source\s+of\s+biological/.test(s) || /^source\s+of\s+isolates/.test(s) || /^source$/.test(s)) return H.source;
    if (/wild-?type|mutant|genotype/.test(s)) return H.status;
    if (/biofilm|planktonic|mixed/.test(s)) return H.mode;
    if (/^drug\b|chemical\s+compound|compound|antibiotic/.test(s)) return H.drug;

    if (/^title$/.test(s)) return H.title;
    if (/^citation$/.test(s)) return H.citation;

    return cleanVal(h);
  }

  function linkifyPlainUrls(raw){
    raw = cleanVal(raw);
    if (!raw) return "—";
    const urlRe = /(https?:\/\/[^\s<>"']+)/gi;

    let out = "";
    let last = 0;
    let found = false;

    raw.replace(urlRe, (match, _g1, offset) => {
      found = true;
      let url = match;
      while (/[),.;:\]]$/.test(url)) url = url.slice(0, -1);

      out += escapeHtml(raw.slice(last, offset));
      out += renderLink(url, url);

      const tail = match.slice(url.length);
      if (tail) out += escapeHtml(tail);

      last = offset + match.length;
      return match;
    });

    out += escapeHtml(raw.slice(last));
    return found ? out : escapeHtml(raw);
  }

  function evidenceHtml(evidenceText, evidenceHref, pmcUrl){
    const t = cleanVal(evidenceText);
    const href = sanitizeHttpUrl(evidenceHref);

    if (href) return renderLink(href, t || "Open evidence link");

    const html = linkifyPlainUrls(t);

    if (pmcUrl && t && t.length <= 80 && /^(table|figure|fig\.?|supp|appendix|dataset|data)\b/i.test(t)) {
      return renderLink(pmcUrl, t);
    }
    return html || "—";
  }

  function detailsHtml(row) {
    const pmcUrl = pmcUrlFromId(row[H.pmc]);

    const title = cleanVal(row[H.title]);
    const citation = cleanVal(row[H.citation]);
    const testedIsolate = cleanVal(row[H.testedIsolate]);

    const evText = row.__evidence_text || row[H.evidence] || "";
    const evHref = row.__evidence_href || "";

    const titleHtml = (pmcUrl && title) ? renderLink(pmcUrl, title) : escapeHtml(title || "—");

    return `
      <div class="detailsBox">
        <div><span class="k">Title:</span> ${titleHtml}</div>
        <div style="margin-top:8px;"><span class="k">Citation:</span> ${escapeHtml(citation || "—")}</div>
        <div style="margin-top:8px;"><span class="k">Tested isolate:</span> ${escapeHtml(testedIsolate || "—")}</div>
        <div style="margin-top:8px;"><span class="k">Evidence:</span> ${evidenceHtml(evText, evHref, pmcUrl)}</div>
      </div>
    `;
  }

  async function loadXlsxRows(filename){
    // ✅ IMPORTANT: encode spaces/parentheses for GitHub Pages URLs
    const res = await fetch(encodeURI(filename));
    if (!res.ok) throw new Error(`Failed to load ${filename}: ${res.status}`);
    const ab = await res.arrayBuffer();
    const wb = XLSX.read(ab, { type: "array" });

    const sheetName = wb.SheetNames[0];
    const ws = wb.Sheets[sheetName];
    if (!ws || !ws["!ref"]) return [];

    const range = XLSX.utils.decode_range(ws["!ref"]);
    const headerRow = range.s.r;

    const headers = [];
    for (let c = range.s.c; c <= range.e.c; c++){
      const addr = XLSX.utils.encode_cell({ r: headerRow, c });
      const cell = ws[addr];
      const raw = cleanVal(cell ? (cell.w ?? cell.v) : "");
      headers.push(canonicalHeader(raw));
    }

    const out = [];
    for (let r = headerRow + 1; r <= range.e.r; r++){
      const rowObj = {};
      let any = false;

      for (let c = range.s.c; c <= range.e.c; c++){
        const addr = XLSX.utils.encode_cell({ r, c });
        const cell = ws[addr];
        const key = headers[c - range.s.c] || "";

        const text = cleanVal(cell ? (cell.w ?? cell.v) : "");
        if (text) any = true;

        if (Object.values(H).includes(key)) {
          rowObj[key] = text;

          if (key === H.evidence && cell && cell.l && cell.l.Target) {
            rowObj.__evidence_text = text;
            rowObj.__evidence_href = cell.l.Target;
          }
        }
      }

      if (any) out.push(rowObj);
    }

    return out;
  }

  function preprocess(rows){
    let lastPMC = "";
    rows.forEach(r => {
      const v = cleanVal(r[H.pmc]);
      if (v) lastPMC = v;
      else r[H.pmc] = lastPMC;
    });

    const expected = Object.values(H);
    rows.forEach(r => {
      expected.forEach(h => { if (!(h in r)) r[h] = ""; });
      if (!("__evidence_text" in r)) r.__evidence_text = r[H.evidence] || "";
      if (!("__evidence_href" in r)) r.__evidence_href = "";
    });

    const metaByPMC = {};
    rows.forEach(r => {
      const pmc = cleanVal(r[H.pmc]) || "__NO_PMC__";
      if (!metaByPMC[pmc]) metaByPMC[pmc] = { title: "", citation: "" };

      const t = cleanVal(r[H.title]);
      const c = cleanVal(r[H.citation]);

      if (t) metaByPMC[pmc].title = t;
      else r[H.title] = metaByPMC[pmc].title;

      if (c) metaByPMC[pmc].citation = c;
      else r[H.citation] = metaByPMC[pmc].citation;
    });

    return rows;
  }

  function initTable(rows){
    const columns = [
      {
        title: "", data: null,
        className: "details-control",
        orderable: false,
        searchable: false,
        width: "24px",
        defaultContent: "+",
        render: () => "+"
      },
      ...VISIBLE_HEADERS.map(h => ({
        title: h,
        data: h,
        render: function (data) {
          if (h === H.pmc) return pmcLink(data);
          return cleanVal(data);
        }
      })),
      { title: H.title, data: H.title, visible: false, searchable: true },
      { title: H.citation, data: H.citation, visible: false, searchable: true },
      { title: H.testedIsolate, data: H.testedIsolate, visible: false, searchable: true },
      { title: H.evidence, data: H.evidence, visible: false, searchable: true }
    ];

    const $titleRow = $("<tr/>");
    const $filterRow = $("<tr class='filters'/>");

    $titleRow.append(`<th></th>`);
    $filterRow.append(`<th></th>`);

    VISIBLE_HEADERS.forEach((h, idxZeroBased) => {
      const dtIdx = idxZeroBased + 1;
      $titleRow.append(`<th>${h}</th>`);

      const hasDropdown = DROPDOWN_COLS.has(h);
      $filterRow.append(`
        <th>
          <div class="colFilter">
            <input type="text" placeholder="Search…" data-col-idx="${dtIdx}">
            ${hasDropdown ? `
              <select data-col-idx="${dtIdx}">
                <option value="">All options</option>
              </select>
            ` : ``}
          </div>
        </th>
      `);
    });

    $("#tbl thead").empty().append($titleRow).append($filterRow);

    const table = $("#tbl").DataTable({
      data: rows,
      columns: columns,
      responsive: false,
      scrollX: true,
      scrollCollapse: true,
      fixedHeader: true,

      pageLength: 25,
      lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
      dom: "Blfrtip",
      stateSave: true,

      buttons: [
        { extend: "copy",  title: "mic-database" },
        { extend: "csv",   title: "mic-database" },
        { extend: "excel", title: "mic-database" },
        { extend: "print", title: "mic-database" },
        { extend: "colvis", text: "Columns" },
        { extend: "colvisRestore", text: "Reset columns" }
      ],

      orderCellsTop: true,
      order: [[ 1, "asc" ]]
    });

    const updateCount = () => {
      const n = table.rows({ filter: "applied" }).count();
      document.getElementById("rowCount").textContent = `${n} rows`;
    };
    updateCount();
    table.on("draw", updateCount);

    VISIBLE_HEADERS.forEach((h, idxZeroBased) => {
      const dtIdx = idxZeroBased + 1;
      if (!DROPDOWN_COLS.has(h)) return;

      const col = table.column(dtIdx);
      let values = uniqueSorted(col.data().toArray());

      const $selects = $(`select[data-col-idx="${dtIdx}"]`);
      $selects.each(function () {
        const $sel = $(this);
        $sel.find("option:not(:first)").remove();
        values.forEach(v => {
          const safe = escapeHtml(v);
          $sel.append(`<option value="${safe}">${safe}</option>`);
        });
      });
    });

    $(document).on("keyup change", 'input[data-col-idx]', function () {
      const idx = Number(this.getAttribute("data-col-idx"));
      const col = table.column(idx);

      const $cell = $(this).closest(".colFilter");
      $cell.find('select[data-col-idx]').val("");

      col.search(this.value || "", false, true).draw();
    });

    $(document).on("change", 'select[data-col-idx]', function () {
      const idx = Number(this.getAttribute("data-col-idx"));
      const col = table.column(idx);
      const val = $(this).val();

      const $cell = $(this).closest(".colFilter");
      $cell.find('input[data-col-idx]').val("");

      col.search(val ? `^${$.fn.dataTable.util.escapeRegex(val)}$` : "", true, false).draw();
    });

    const idxPMC     = VISIBLE_HEADERS.indexOf(H.pmc) + 1;
    const idxParam   = VISIBLE_HEADERS.indexOf(H.parameter) + 1;
    const idxDrug    = VISIBLE_HEADERS.indexOf(H.drug) + 1;
    const idxSpecies = VISIBLE_HEADERS.indexOf(H.species) + 1;

    document.getElementById("pmcGlobal").addEventListener("input", (e) => {
      table.column(idxPMC).search(e.target.value || "", false, true).draw();
    });
    document.getElementById("paramGlobal").addEventListener("input", (e) => {
      table.column(idxParam).search(e.target.value || "", false, true).draw();
    });
    document.getElementById("drugGlobal").addEventListener("input", (e) => {
      table.column(idxDrug).search(e.target.value || "", false, true).draw();
    });
    document.getElementById("speciesGlobal").addEventListener("input", (e) => {
      table.column(idxSpecies).search(e.target.value || "", false, true).draw();
    });
    document.getElementById("titleGlobal").addEventListener("input", (e) => {
      table.search(e.target.value || "", false, true).draw();
    });

    function toggleRow(tr){
      const row = table.row(tr);
      const $tr = $(tr);
      const $ctrl = $tr.find("td.details-control");
      if (!$ctrl.length) return;

      if (row.child.isShown()) {
        row.child.hide();
        $tr.removeClass("shown");
        $ctrl.text("+");
      } else {
        row.child(detailsHtml(row.data())).show();
        $tr.addClass("shown");
        $ctrl.text("–");
      }
    }

    $("#tbl tbody").on("click", "td.details-control", function (e) {
      e.stopPropagation();
      toggleRow($(this).closest("tr"));
    });

    $("#tbl tbody").on("click", "tr", function (e) {
      if ($(this).hasClass("child")) return;
      if ($(e.target).closest("a, button, input, select, textarea, label").length) return;
      toggleRow(this);
    });

    document.getElementById("clearAll").addEventListener("click", () => {
      table.search("");
      table.columns().search("");

      $("#tbl thead tr.filters input").val("");
      $("#tbl thead tr.filters select").val("");

      document.getElementById("titleGlobal").value = "";
      document.getElementById("pmcGlobal").value = "";
      document.getElementById("paramGlobal").value = "";
      document.getElementById("drugGlobal").value = "";
      document.getElementById("speciesGlobal").value = "";

      table.rows().every(function () {
        if (this.child.isShown()) this.child.hide();
      });
      $("#tbl tbody tr").removeClass("shown");
      $("#tbl tbody td.details-control").text("+");

      table.draw();
    });
  }

  (async () => {
    try {
      const rawRows = await loadXlsxRows(XLSX_FILE);
      const rows = preprocess(rawRows);
      if (!rows.length) {
        alert("No rows loaded. Check the sheet header row and file name.");
        return;
      }
      initTable(rows);
    } catch (err) {
      console.error(err);
      alert(String(err));
    }
  })();

})();
</script>

</body>
</html>
